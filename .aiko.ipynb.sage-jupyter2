{"type":"settings","kernel":"anaconda3","backend_state":"running","trust":true,"kernel_state":"idle"}
{"type":"file","last_load":1547646940840}
{"output":{"0":{"name":"stdout","text":"/PartType0/Coordinates\n/PartType0/Velocities\n/PartType0/Density\n"},"1":{"name":"stdout","text":"/PartType4/Coordinates\n/PartType4/Velocities\n/PartType4/Density\n"},"2":{"traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mKeyError\u001b[0m                                  Traceback (most recent call last)","\u001b[0;32m<ipython-input-86-7734db09f5fd>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[1;32m     88\u001b[0m \u001b[0ma\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0msnapshot\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0msnapPath\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m\"/store/clues/HESTIA/RE_SIMS/2048/GAL_FOR/37_11/output/snapdir_127\"\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mparticleTypes\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"Gas\"\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m\"Stars\"\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mblockNames\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"Coordinates\"\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m\"Velocities\"\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m\"Density\"\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     89\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 90\u001b[0;31m \u001b[0mprint\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0ma\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mread_arepo\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m","\u001b[0;32m<ipython-input-86-7734db09f5fd>\u001b[0m in \u001b[0;36mread_arepo\u001b[0;34m(self)\u001b[0m\n\u001b[1;32m     57\u001b[0m                     \u001b[0mh5Path\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;34m\"/PartType{}/{}\"\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mformat\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mparticleTypeIndex\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mblockName\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     58\u001b[0m                     \u001b[0mprint\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mh5Path\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 59\u001b[0;31m                     \u001b[0mID\u001b[0m  \u001b[0;34m=\u001b[0m \u001b[0mnp\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0muint32\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mfile\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0mh5Path\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mvalue\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     60\u001b[0m                     \u001b[0mdfStructure\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"ID\"\u001b[0m\u001b[0;34m]\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mID\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     61\u001b[0m                     \u001b[0;32mif\u001b[0m \u001b[0mblockName\u001b[0m \u001b[0;34m==\u001b[0m \u001b[0;34m\"Coordinates\"\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32mh5py/_objects.pyx\u001b[0m in \u001b[0;36mh5py._objects.with_phil.wrapper\u001b[0;34m()\u001b[0m\n","\u001b[0;32mh5py/_objects.pyx\u001b[0m in \u001b[0;36mh5py._objects.with_phil.wrapper\u001b[0;34m()\u001b[0m\n","\u001b[0;32m/projects/anaconda3/lib/python3.6/site-packages/h5py/_hl/group.py\u001b[0m in \u001b[0;36m__getitem__\u001b[0;34m(self, name)\u001b[0m\n\u001b[1;32m    175\u001b[0m                 \u001b[0;32mraise\u001b[0m \u001b[0mValueError\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"Invalid HDF5 object reference\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    176\u001b[0m         \u001b[0;32melse\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 177\u001b[0;31m             \u001b[0moid\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mh5o\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mopen\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mid\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_e\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mname\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mlapl\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_lapl\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    178\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    179\u001b[0m         \u001b[0motype\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mh5i\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mget_type\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0moid\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32mh5py/_objects.pyx\u001b[0m in \u001b[0;36mh5py._objects.with_phil.wrapper\u001b[0;34m()\u001b[0m\n","\u001b[0;32mh5py/_objects.pyx\u001b[0m in \u001b[0;36mh5py._objects.with_phil.wrapper\u001b[0;34m()\u001b[0m\n","\u001b[0;32mh5py/h5o.pyx\u001b[0m in \u001b[0;36mh5py.h5o.open\u001b[0;34m()\u001b[0m\n","\u001b[0;31mKeyError\u001b[0m: \"Unable to open object (object 'Density' doesn't exist)\""],"ename":"KeyError","evalue":"\"Unable to open object (object 'Density' doesn't exist)\""}},"exec_count":86,"start":1547736709601,"input":"#class for reading/writing/handlin of snapshot directories, managed by aiko\nclass snapshot():\n    #sets path of snapshot dir (corrects for missing slash at end of path)\n    def __init__(self, snapPath, blockNames, particleTypes):\n        if snapPath[-1] is not \"/\":\n            snapPath = snapPath + \"/\"\n        self.snapPath = snapPath\n        self.blockNames = blockNames\n        self.particleTypes = particleTypes\n        self.particleTypeIndexes = self.get_particleType_index()\n        self.numSnapdirs = self.get_numSnapdirs()\n        self.currentSnapshot = self.get_snapshot()\n\n    #searches for a file with correct name, opens and gets number of snaps from header\n    def get_numSnapdirs(self):\n        for i in os.listdir(self.snapPath):\n            if re.search(\"\\.\\d\\.\", i):\n                fileName = i\n                break\n        filePath = self.snapPath + fileName\n        file = h5py.File(filePath, 'r')\n        attrs = file['/Header'].attrs\n        numFilesPerSnapshot = attrs[\"NumFilesPerSnapshot\"]\n        return numFilesPerSnapshot\n\n    #converts words of particleTypes to particleTypeIndexes\n    def get_particleType_index(self):\n        indexList = []\n        index = {\"Gas\":0, \"DM\":1, \"Darkmatter\":1, \"Stars\":4}\n        for particleType in self.particleTypes:\n            converted = index[particleType]\n            indexList.append(converted)\n        return indexList\n\n    #returns current snapshot\n    def get_snapshot(self):\n        for i in os.listdir(self.snapPath):\n            if re.search(\"\\_\\d{3}\\.\", i):\n                snapshot = re.findall(\"\\_\\d{3}\\.\", i)[0][1:4]\n                return int(snapshot)\n\n    #returns list of all filenames in dir\n    def get_snapdirList(self):\n        return os.listdir(self.snapPath)\n\n    #returns\n    def read_arepo(self):\n        dfSnapList = {}\n        snapIter = 0\n        for filename in self.get_snapdirList():\n            file = h5py.File(self.snapPath +  filename, \"r\")\n            dfFileList = {}\n            for particleTypeIndex in self.particleTypeIndexes:\n                dfStructure = {}\n                fileIter = 0\n                for blockName in self.blockNames:\n                    h5Path = \"/PartType{}/{}\".format(particleTypeIndex, blockName)\n                    print(h5Path)\n                    ID  = np.uint32(file[h5Path].value)\n                    dfStructure[\"ID\"] = ID\n                    if blockName == \"Coordinates\":\n                        coords = np.float32(file[h5Path].value)\n                        dfStructure[\"posX\"] = coords[:,0]\n                        dfStructure[\"posY\"] = coords[:,1]\n                        dfStructure[\"posZ\"] = coords[:,2]\n                    if blockName == \"Velocities\":\n                        vels = np.float32(file[h5Path].value)\n                        dfStructure[\"velX\"] = vels[:,0]\n                        dfStructure[\"velY\"] = vels[:,1]\n                        dfStructure[\"velZ\"] = vels[:,2]\n                    #if blockName == \"Density\" and particleTypeIndex == 0:\n                     #   print(particleTypeIndex, blockName, filename)\n                     #   dens = np.float32(file[h5Path].value)\n                     #   dfStructure[\"Dens\"] = dens\n                dfStructure[\"Snap\"] = ID*0+self.currentSnapshot\n                dfStructure[\"Type\"] = ID*0+particleTypeIndex\n                dfCurrent = pd.DataFrame(dfStructure)\n                dfFileList[fileIter] = dfCurrent\n                fileIter += 1\n            dfFile = pd.concat(dfCurrent)\n            dfSnapList[snapIter] = dfFile\n            snapIter =+ 1\n        dfSnap = pd.concat(dfSnapList)\n        return dfSnap\n\n#{\"x\":pos[:,0],\"y\":pos[:,1],\"z\":pos[:,2],\"dens\":dens , \"ID\":ID, \"snap\":ID*0+s}\n#pos = np.float32(f['/PartType0/Coordinates'].value)\na = snapshot(snapPath=\"/store/clues/HESTIA/RE_SIMS/2048/GAL_FOR/37_11/output/snapdir_127\", particleTypes=[\"Gas\", \"Stars\"], blockNames=[\"Coordinates\", \"Velocities\", \"Density\"])\n\nprint(a.read_arepo())","scrolled":true,"state":"done","pos":1,"type":"cell","end":1547736709969,"id":"1348e4","kernel":"anaconda3"}
{"exec_count":5,"input":"#aiko package\n#Denis Titov\n#16.01.2019\n#\n\n\"\"\"\naiko gives read/write functionality for a .hdf5 database.\nso far it only works on that specific database :/\n*path*/snapdir_000/snapshot_000.0.hdf5\n\"\"\"\n\nimport h5py\nimport numpy as np\nimport sys\nimport os\nimport pandas as pd\nimport re","state":"done","pos":0,"type":"cell","id":"326cc8","kernel":"anaconda3"}
{"type":"cell","id":"4938fd","pos":2,"input":"class aiko():\n    def __init__(self, path):\n        self.path = path\n    \n    def read_repo():\n        pathList = aiko.get_path_list()\n        pathList = pathList[-48:]\n        for i in range(len(pathList)):\n            #TODO read funktion inform\n            f = h5py.File(pathList[i], \"r\")\n            s = int(pathList[i][62:65])\n            #type=0\n            pos = np.float32(f['/PartType0/Coordinates'].value)\n            ID  = np.uint32(f['/PartType0/ParticleIDs'].value)\n            dens = np.array(f['PartType0/Density'])\n            df0=pd.DataFrame({\"x\":pos[:,0],\"y\":pos[:,1],\"z\":pos[:,2],\"dens\":dens , \"ID\":ID,         \"snap\":ID*0+s})\n            dfallList[i]=df0\n            print(i)\n            #TODO close f\n        dfa = pd.concat(dfallList)\n        print(\"Done!\")\n\n    def get_path_list():\n        pathList = []\n        for i in range(aiko.numSnapdirs):\n            currentSnapdir = \"snapdir_\" + \"%03d\" % i + \"/\"\n            for j in range(aiko.numSnapshots):\n                currentSnapshot = \"snapshot_\" + \"%03d\" % i + \".\" + str(j) + \".hdf5\"\n                currentPath = aiko.path + currentSnapdir + currentSnapshot\n                pathList.append(currentPath)\n        return pathList\n\n    \n\n\"\"\"\nTODO:\n\nread FILE FOLDER REPOSITORY ETC.\n\nwrite TO DATABASE, MULTIPLE FILES ETC.\n\nconvert TO PANDAS, TO NUMPY (SELECTION, SLICE) ETC.\n\ngive direkt dirname\n\"\"\""}